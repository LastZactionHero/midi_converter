import mido

def string_to_midi(input_string, output_filename="output.mid", instrument=0, ticks_per_beat=480, tempo=120):
    """
    Converts a string in the format "Note-Time-Duration|Note-Time-Duration|..." 
    to a MIDI file.

    Args:
        input_string (str): The input string representing the music.
        output_filename (str): The name of the output MIDI file.
        instrument (int): MIDI program number for the instrument (0-127).
        ticks_per_beat (int): Ticks per beat for the MIDI file.
        tempo (int): Tempo in beats per minute (BPM).
    """

    # Create a new MIDI file with one track
    mid = mido.MidiFile(ticks_per_beat=ticks_per_beat)
    track = mido.MidiTrack()
    mid.tracks.append(track)

    # Set instrument
    track.append(mido.Message('program_change', program=instrument, time=0))

    # Set tempo (microseconds per beat)
    microseconds_per_beat = mido.bpm2tempo(tempo)
    track.append(mido.MetaMessage('set_tempo', tempo=microseconds_per_beat, time=0))

    # Parse the input string
    notes = input_string.split('|')
    
    last_time = 0

    for note_str in notes:
        if not note_str:
            continue
            
        parts = note_str.split(',')

        for part in parts:
          try:
              note, time_str, duration_str = part.split('-')
              time = int(time_str)
              duration = int(duration_str)

              # Convert note string to MIDI note number
              note_number = string_to_note(note)
              if note_number is None:
                  print(f"Skipping invalid note: {note}")
                  continue

              # Append note_on and note_off messages
              track.append(mido.Message('note_on', note=note_number, velocity=100, time=time - last_time))
              track.append(mido.Message('note_off', note=note_number, velocity=0, time=duration))
              
              last_time = time

          except ValueError:
              print(f"Skipping invalid note format: {part}")

    # Save the MIDI file
    mid.save(output_filename)

# --- String to MIDI Note Conversion ---
# (This function is the same as in the previous responses)
def string_to_note(note_string):
    """Converts a note string (e.g., C#4, D5) to a MIDI note number."""
    notes = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"]

    if not note_string:
        print("Error: Empty note string provided.")
        return None

    try:
        note_part = note_string[:-1]
        octave_part = note_string[-1]

        if not note_part or not octave_part:
            print(f"Error: Invalid note string format: '{note_string}'. Missing note or octave.")
            return None

        note_index = notes.index(note_part)
        octave = int(octave_part)
        note_number = note_index + (octave * 12)

        if 0 <= note_number <= 127:
            return note_number
        else:
            print(f"Error: Note number out of range (0-127): '{note_string}'.")
            return None

    except ValueError:
        print(f"Error: Invalid note string: '{note_string}'.")
        return None

input_string = "B3-0-1452|F#4-480-1440|B4-480-1440|C#5-480-1440|F#3-1280-136|A3-1440-12|A3-1452-424|A3-1920-1400|A4-2400-960|E4-2400-960|A4-3360-480|E4-3360-480|A3-3360-480|E4-3840-1920|B4-4320-960|F#5-4320-964|E5-4320-964|B4-5280-480|E5-5284-476|E4-5760-960|E5-6240-480|F#5-6240-480|B4-6240-480|B3-6720-960|B4-7200-480|C#5-7200-480|F#4-7200-480|E4-7680-1452|B4-8160-1440|E5-8160-1440|F#5-8160-1440|B3-8960-136|D4-9120-12|D4-9132-424|A3-9600-1400|A4-10080-960|E4-10080-960|A4-11040-480|E4-11040-480|A3-11040-480|E4-11520-1400|E5-12000-960|B4-12000-960|B4-12960-940|E5-12960-960|E4-12960-1892|B4-13920-916|E5-13920-972|B4-14880-12|E4-14880-480|E5-14892-288|B4-14892-468|E5-15200-160|A3-15360-1452|E4-15840-1860|A4-15840-1920|B4-15840-3012|E3-16640-136|G3-16800-12|G3-16812-424|A3-17280-1436|E4-17760-808|A4-17760-1428|E4-18568-620|C4-18720-424|E4-19200-1400|E5-19680-960|B4-19680-960|B4-20640-940|E5-20640-960|E4-20640-1892|B4-21600-916|E5-21600-972|B4-22560-12|E4-22560-480|E5-22572-288|B4-22572-468|E5-22880-160|B3-23040-1452|F#4-23520-1440|B4-23520-1440|C#5-23520-1440|F#3-24320-136|A3-24480-12|A3-24492-424|A3-24960-1400|A4-25440-960|E4-25440-960|A4-26400-480|E4-26400-480|A3-26400-480|E4-26880-1400|E5-27360-960|B4-27360-960|E5-28320-480|B4-28320-480|E4-28320-480|B3-28800-1400|B4-29280-960|F#4-29280-960|B4-30240-480|F#4-30240-480|B3-30240-480|E4-30720-1452|B4-31200-1440|E5-31200-1440|F#5-31200-1440|B3-32000-136|D4-32160-12|D4-32172-424|A3-32640-1452|E4-33120-1440|A4-33120-1440|B4-33120-1440|E3-33920-136|G3-34080-12|G3-34092-424|E4-34560-1452|B4-35040-1860|E5-35040-1920|F#5-35040-3012|B3-35840-136|D4-36000-12|D4-36012-424|E4-36480-1436|B4-36960-808|E5-36960-1428|B4-37768-620|G4-37920-424|A3-38400-1920|E4-38880-960|B4-38880-964|A4-38880-964|E4-39840-964|A4-39844-956|A3-40800-1016|E4-40804-1436|A4-40804-1436|E3-41600-160|G3-41760-56|A3-41816-424|G3-41816-424|E4-42240-1920|B4-42720-960|F#5-42720-964|E5-42720-964|B4-43680-964|E5-43684-956|E4-44640-1016|B4-44644-1436|E5-44644-1436|B3-45440-160|D4-45600-56|E4-45656-424|D4-45656-424|B3-46080-1452|F#4-46560-1440|B4-46560-1440|C#5-46560-1440|F#3-47360-136|A3-47520-12|A3-47532-424|A3-48000-1400|A4-48480-960|E4-48480-960|A4-49440-480|E4-49440-480|A3-49440-480|E4-49920-1400|E5-50400-960|B4-50400-960|E5-51360-480|B4-51360-480|E4-51360-480|B3-51840-1920|F#4-52320-960|C#5-52320-964|B4-52320-964|F#4-53280-480|B4-53284-476|E4-53760-1920|B4-54240-960|F#5-54240-964|E5-54240-964|B4-55200-480|E5-55204-476|A3-55680-1920|E4-56160-960|B4-56160-964|A4-56160-964|E4-57120-480|A4-57124-476|E4-57600-1920|B4-58080-960|F#5-58080-964|E5-58080-964|B4-59040-964|E5-59044-956|E4-60000-1016|B4-60004-1436|E5-60004-1436|B3-60800-160|D4-60960-56|E4-61016-424|D4-61016-424|A3-61440-1400|A4-61920-960|E4-61920-960|E4-62880-940|A4-62880-960|A3-62880-1892|E4-63840-916|A4-63840-972|E4-64800-12|A3-64800-480|A4-64812-288|E4-64812-468|A4-65120-160|E4-65280-1452|B4-65760-1860|E5-65760-1920|F#5-65760-3012|B3-66560-136|D4-66720-12|D4-66732-424|E4-67200-1436|B4-67680-808|E5-67680-1428|B4-68488-620|G4-68640-424|B3-69120-1400|B4-69600-960|F#4-69600-960|B4-70560-480|F#4-70560-480|B3-70560-480|A3-71040-1452|E4-71520-1440|A4-71520-1440|B4-71520-1440|E3-72320-136|G3-72480-12|G3-72492-424|E4-72960-1400|E5-73440-960|B4-73440-960|E5-74400-480|B4-74400-480|E4-74400-480|B3-74880-1920|F#4-75360-960|C#5-75360-964|B4-75360-964|F#4-76320-480|B4-76324-476|E4-76800-1920|B4-77280-960|F#5-77280-964|E5-77280-964|B4-78240-480|E5-78244-476|A3-78720-1920|E4-79200-960|B4-79200-964|A4-79200-964|E4-80160-480|A4-80164-476|E4-80640-1400|E5-81120-960|B4-81120-960|B4-82080-940|E5-82080-960|E4-82080-1892|B4-83040-916|E5-83040-972|B4-84000-12|E4-84000-480|E5-84012-288|B4-84012-468|E5-84320-160|A3-84480-1920|E4-84960-960|B4-84960-964|A4-84960-964|E4-85920-964|A4-85924-956|A3-86880-1016|E4-86884-1436|A4-86884-1436|E3-87680-160|G3-87840-56|A3-87896-424|G3-87896-424|E4-88320-1452|B4-88800-1860|E5-88800-1920|F#5-88800-3012|B3-89600-136|D4-89760-12|D4-89772-424|E4-90240-1436|B4-90720-808|E5-90720-1428|B4-91528-620|G4-91680-424|B3-92160-1400|B4-92640-960|F#4-92640-960|B4-93600-480|F#4-93600-480|B3-93600-480|A3-94080-1920|E4-94560-960|B4-94560-964|A4-94560-964|E4-95520-480|A4-95524-476|E4-96000-1452|B4-96480-1440|E5-96480-1440|F#5-96480-1440|B3-97280-136|D4-97440-12|D4-97452-424|B3-97920-1400|B4-98400-960|F#4-98400-960|B4-99360-480|F#4-99360-480|B3-99360-480|E4-99840-1920|B4-100320-960|F#5-100320-964|E5-100320-964|B4-101280-480|E5-101284-476|A3-101760-1400|A4-102240-960|E4-102240-960|A4-103200-480|E4-103200-480|A3-103200-480|E4-103680-1452|B4-104160-1860|E5-104160-1920|F#5-104160-3012|B3-104960-136|D4-105120-12|D4-105132-424|E4-105600-1436|B4-106080-808|E5-106080-1428|B4-106888-620|G4-107040-424|A3-107520-1452|E4-108000-1860|A4-108000-1920|B4-108000-3012|E3-108800-136|G3-108960-12|G3-108972-424|A3-109440-1436|E4-109920-808|A4-109920-1428|E4-110728-620|C4-110880-424|E4-111360-1452|B4-111840-1860|E5-111840-1920|F#5-111840-3012|B3-112640-136|D4-112800-12|D4-112812-424|E4-113280-1436|B4-113760-808|E5-113760-1428|B4-114568-620|G4-114720-424|B3-115200-1400|B4-115680-960|F#4-115680-960|B4-116640-480|F#4-116640-480|B3-116640-480|A3-117120-1920|E4-117600-960|B4-117600-964|A4-117600-964|E4-118560-480|A4-118564-476|E4-119040-1452|B4-119520-1440|E5-119520-1440|F#5-119520-1440|B3-120320-136|D4-120480-12|D4-120492-424|B3-120960-1452|F#4-121440-1440|B4-121440-1440|C#5-121440-1440|F#3-122240-136|A3-122400-12|A3-122412-424|E4-122880-1452|B4-123360-1440|E5-123360-1440|F#5-123360-1440|B3-124160-136|D4-124320-12|D4-124332-424|A3-124800-1452|E4-125280-1440|A4-125280-1440|B4-125280-1440|E3-126080-136|G3-126240-12|G3-126252-424|E4-126720-1920|B4-127200-960|F#5-127200-964|E5-127200-964|B4-128160-964|E5-128164-956|E4-129120-1016|B4-129124-1436|E5-129124-1436|B3-129920-160|D4-130080-56|E4-130136-424|D4-130136-424|A3-130560-1400|A4-131040-960|E4-131040-960|A4-132000-480|E4-132000-480|A3-132000-480|A3-132480-1920|E4-132960-960|B4-132960-964|A4-132960-964|E4-133920-480|A4-133924-476|E4-134400-1452|B4-134880-1860|E5-134880-1920|F#5-134880-3012|B3-135680-136|D4-135840-12|D4-135852-424|E4-136320-1436|B4-136800-808|E5-136800-1428|B4-137608-620|G4-137760-424|B3-138240-1920|F#4-138720-960|C#5-138720-964|B4-138720-964|F#4-139680-480|B4-139684-476|A3-140160-1452|E4-140640-1440|A4-140640-1440|B4-140640-1440|E3-141440-136|G3-141600-12|G3-141612-424|E4-142080-1920|B4-142560-960|F#5-142560-964|E5-142560-964|B4-143520-480|E5-143524-476|D4-144000-480|D#4-144480-300|E4-144820-1060"
string_to_midi(input_string, "output.mid")
